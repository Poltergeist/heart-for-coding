function dc(x, y, s){
  return function(){
    s = s || 10;
    var d = s * 2;
    c.m(x,y);
    c.l(x+s,y-s);
    c.l(x+d,y);
    c.l(x+d,y);
    c.l(x+d,y+s);
    c.l(x+s,y+d);
    c.l(x,y+s);
    c.f();
  };
}
function d3D(x, y, s){
  return function(){
    c.m(x,y);
    c.l(x, y+s);
    c.l(x+(s*2),y+(s*3));
    c.l(x+(s*4),y+s);
    c.l(x+(s*4),y);
    c.f();
  };
}
function dh(f){
  var sh = s / 2;
  st(dc(x+s, y+s, s), 200);
  st(dc(x+(s*2), y, s), 400);
  st(d3D(x, y, s), 400);
  st(next, 600);
  if (!f) {
    st(dc(x+sh, y-sh, sh), 0);
    return;
  }
  st(dc(x, y, s), 0);

}
function d(){
  m = 128;

  x = r() * w;
  y = r() * h;
  c.closePath();
  c.beginPath();
  c.fillStyle = 'hsl(' + ma.ceil(r()*359) + ',50%,50%)';
  dh(1);
  s += s;

}
function next(){
  if (s <= m) {
    dh();
    s += s ;
    return;
  }
  s = 1;
  d();
}
var b = document.getElementById('C'),
  c=b.getContext('2d'),
  st = setTimeout,
  w = innerWidth,
  h = innerHeight,
  s = 1,
  ma = Math,
  r = ma.random,
  m, x, y;
for(p in c){
  c[p[0]+(p[6]||'')] = c[p];
}
b.width = w;
b.height = h;
next();
