function dc(c, x, y, s){
  return function(){
    s = s || 10;
    var sd = s * 2;
    mt(x,y);
    lt(x+s,y-s);
    lt(x+sd,y);
    lt(x+sd,y);
    lt(x+sd,y+s);
    lt(x+s,y+sd);
    lt(x,y+s);
    c.fill();
  };
}
function d3D(c, x, y, s){
  return function(){
    mt(x,y);
    lt(x, y+s);
    lt(x+(s*2),y+(s*3));
    lt(x+(s*4),y+s);
    lt(x+(s*4),y);
    c.fill();
  }
}
function dh(c, x, y, s, first){
  var sh = s / 2;
  st(dc(c, x+s, y+s, s), 200);
  st(dc(c, x+(s*2), y, s), 400);
  st(d3D(c, x, y, s), 400);
  st(next, 600);
  if (!first) {
    st(dc(c, x+sh, y-sh, sh), 0);
    return;
  }
  st(dc(c, x, y, s), 0);

}
function r() {
  b.width = wi;
  b.height = ht;

}
function d(r){
  m = ma.pow(2, r) || 64;
  x = (wi / 2) - (m * 2);
  y = (ht / 2) - (m);

  x = mr() * wi;
  y = mr() * ht;
  c.closePath();
  c.beginPath();
  c.fillStyle = 'hsl(' + ma.ceil(mr()*359) + ',50%,50%)';
  dh(c, x, y, s, 1);
  s += s;

}
function next(){
  if (s <= m) {
    dh(c, x, y, s);
    s += s ;
    return;
  }
  s = 1;
  d(7);
}
var b = document.getElementById('C'),
  c=b.getContext('2d'),
  lt = function(x, y){
    c.lineTo(x, y);
  },
  mt = function(x, y){
    c.moveTo(x, y);
  },
  st = setTimeout,
  s = 1,
  wi = innerWidth,
  ht = innerHeight,
  ma = Math,
  mr = ma.random,
  m, x, y;
for(p in c){
  c[p[0]+(p[6]||'')] = c[p];
}
r();
next();
